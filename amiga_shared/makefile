# Makefile for project "fontconfig"
# Automatically generated by idltool
# 
# $Id: genskeleton.cpp,v 1.13 2010-03-17 14:37:07 cmincea Exp $
# 

#include ../Makefile.amiga.common

# Uncomment the next line if you are cross compiling
CROSS_COMPILE = ppc-amigaos-
CC     = $(CROSS_COMPILE)gcc
STRIP  = $(CROSS_COMPILE)strip
CXX    = $(CROSS_COMPILE)c++ 
AS     = $(CROSS_COMPILE)as 
AR     = $(CROSS_COMPILE)ar
LD     = $(CROSS_COMPILE)ld 
RANLIB = $(CROSS_COMPILE)ranlib 
RM     = rm -Rf
CP	   = cp
MKDIR  = mkdir -p

# Change these as required
OPTIMIZE = -O2 -fomit-frame-pointer
DEBUG    = -gstabs # -DDEBUG
CFLAGS   = -I. -Iinclude -I../fontconfig -I/usr/ppc-amigaos/SDK/local/common/include/freetype2 -I../lib/ -Wall $(AMIGA_CFLAGS) $(OPTIMIZE) $(DEBUG)

# Flags passed to gcc during linking
LINK = -static -gstabs -L../lib/.libs -Wl,--no-undefined

# Name of the "thing" to build
TARGET = fontconfig.library

# Additional linker libraries
LIBS = ../src/.libs/libfontconfig.a 

# Version of the library to build
VERSION = 54

# -------------------------------------------------------------
# Nothing should need changing below this line

SRCS = init.c stubs.c
OBJS = $(SRCS:.c=.o)

LINKOBJS = autoinit_fontconfig_base.o autoinit_fontconfig_main.o libstubs.o #fontconfig_globals.o

all: compilelib $(TARGET) libfontconfig.a

# Rules for building
$(TARGET): $(OBJS)
	$(CC) $(LINK) -nostartfiles -o $@.debug $(OBJS) $(LIBS) -Wl,-L.,--cref,-M,-Map=$@.debug.map
	$(STRIP) -R.comment $@.debug -o $@

libfontconfig.a: $(LINKOBJS)
	$(AR) rcs $@ $(LINKOBJS)
	$(MKDIR) SDK/lib
	$(CP) $@ ./SDK/lib/

compilelib:
	$(RM) $(TARGET) $(TARGET).debug*
ifeq (,$(wildcard ../s/.libs/libfontconfig.a))
ifeq (,$(wildcard ../configure))
	cd ..; PKG_CONFIG_PATH=/SDK/local/newlib/lib/pkgconfig ./configure --prefix=$(shell pwd)/SDK --host=ppc-amigaos --exec-prefix=/usr/ppc-amigaos/SDK/local/newlib --disable-shared --enable-static --disable-dependency-tracking --with-default-fonts="Fonts:_TrueType" --with-cache-dir="ENVARC:fontconfig/cache" CPPFLAGS="-gstabs" --with-templatedir="ENVARC:fontconfig/conf.avail" --with-baseconfigdir="ENVARC:fontconfig/"  --disable-docs --disable-docbook; cd amiga_shared;
endif
	cd ..; make && make install; cd amiga_shared;
endif

.PHONY: clean
clean:
	cd ..; make clean; cd amiga_shared;
	$(RM) $(TARGET) *.debug* $(OBJS) $(LINKOBJS) libfontconfig.a SDK

.PHONY: revision
revision:
	bumprev $(VERSION) $(TARGET)
